= form_for @user, html: { class: 'py-4 form needs-validation', novalidate: true } do |f|
  - if @user.errors.any?
    #error_explanation
      %h2= "#{pluralize(@user.errors.count, "error")} prohibited this user from being saved:"
      %ul
        - @user.errors.full_messages.each do |message|
          %li= message

  .form-row
    .col-2
      = f.label :username
    .col-4
      = f.text_field :username, class: 'form-control mb-4', required: true
      .invalid-feedback
        Username ist erforderlich
  .form-row
    .col-2
      = f.label :email
    .col-4
      = f.email_field :email, class: 'form-control mb-4', required: true
      .invalid-feedback
        gültige Email-Adresse ist erforderlich
  - unless @user.persisted?
    .form-row
      .col-2
        = f.label :password
      .col-4
        = f.password_field :password, class: 'form-control mb-4', required: true, minlength: 8
        .invalid-feedback
          mindestens 8 Zeichen erforderlich
    .form-row
      .col-6.text-right
        .actions.pt-2
          = f.submit 'Speichern', class: 'btn btn-save'


  - if @user.persisted?
    .form-row
      .col-6.text-right
        .actions.pt-2
          %button.btn{ type: 'button', 'data-toggle': 'modal', 'data-target': '#passwordForm'}
            Passwort ändern
          = f.submit 'Speichern', class: 'btn btn-save'
    .edit-actions
      .form-row
        .col-2
          = f.label :roles
        .col-4
          - @user.roles.each do |role|
            = role.name
      .form-row
        .col-2
          = f.label :otp_active
        .col-1
          .icon-toggler.small{ class: @user.otp_required_for_login? ? 'on' : 'off' }
            = svg 'lock'
            .on
              %strong aktiv
            .off
              %p inaktiv

        .col-3.text-right
          - if @user.otp_required_for_login
            %button.btn.icon-button{ type: 'button', 'data-toggle': 'modal', 'data-target': '#qrCode'}
              = svg 'iphone'
              QR-Code Anzeigen
          - else
            = link_to enable_user_path(@user), method: :patch, class: 'icon-button btn' do
              = svg 'key'
              Aktivieren

= render 'password_form'
= javascript_pack_tag 'form_validation'
